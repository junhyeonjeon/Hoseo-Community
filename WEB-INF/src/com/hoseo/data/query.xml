<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="query">
	<typeAlias alias="BoardDto" type="com.hoseo.board.BoardDto" />
	<typeAlias alias="MemberDto" type="com.hoseo.member.MemberDto" />
	<typeAlias alias="GalleryDto" type="com.hoseo.gallery.GalleryDto" />

	<!-- 회원 추가 -->
	<insert id="Member.insert" parameterClass="MemberDto">
		<!--자동으로 seq 증가 -->
		<selectKey resultClass="int" keyProperty="seq">
			select
			nvl(max(seq)+1, 1) from member
		</selectKey>
		insert into member
		(
		seq
		,userid
		,password
		,username
		,birth
		,email
		,phone
		,wdate
		,mdate
		,delyn
		)
		values
		(
		#seq#
		,#userid#
		,#pw1#
		,#username#
		,#birth#
		,#email#
		,#phone#
		,sysdate
		,sysdate
		,'N'
		)
	</insert>
	
	<!-- 로그인 아이디 체크 -->
	<select id="Member.login_id" parameterClass="MemberDto" resultClass="int">
		select count(*)
		from member
		where userid = #userid#
	</select>
	
	<!-- 로그인 비밀번호 체크 -->
	<select id="Member.login" parameterClass="MemberDto" resultClass="String">
		select password
		from member
		where userid = #userid#
	</select>
	
	<!-- 갤러리 목록 가져오기 -->
	<select id="Gallery.getlist" parameterClass="int" resultClass="GalleryDto">
		select *
        from gallery
        where seq between ((#pg#-1)*8)+1 and ((#pg#-1)*8)+8
        order by seq desc
	</select>
	
	<!-- 갤러리 게시글 총 갯수 -->
	<select id="Gallery.totalList" resultClass="int">
		select count(*) from gallery
	</select>
	
	<insert id="Gallery.upload" parameterClass="GalleryDto">
		<!--자동으로 seq 증가 -->
		<selectKey resultClass="int" keyProperty="seq">
			select nvl(max(seq)+1, 1) from gallery
		</selectKey>
		
		insert into gallery(seq, title, contents, url)
		values(
			#seq#
			,#title#
			,#contents#
			,
			<iterate property="filename" conjunction=",">
				#filename[]#
			</iterate>
		)	
	</insert>

</sqlMap>